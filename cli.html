

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tbot CLI &mdash; tbot 0.10.9-5-ga47582c documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5349f25f" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/documentation_options.js?v=8047a51e"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/tbot-logo-white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">tbot CLI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-flags"><code class="docutils literal notranslate"><span class="pre">-f</span></code> Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#k-keep-alive"><code class="docutils literal notranslate"><span class="pre">-k</span></code> Keep Alive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v-verbose"><code class="docutils literal notranslate"><span class="pre">-v</span></code> Verbose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-to-newbot">Migrating to <code class="docutils literal notranslate"><span class="pre">newbot</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="context.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytest.html">pytest Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrating from tbot 0.7.1</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/main.html"><code class="docutils literal notranslate"><span class="pre">tbot</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/log.html"><code class="docutils literal notranslate"><span class="pre">tbot.log</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_linux.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.linux</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_board.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.board</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_connector.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.connector</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_shell.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.shell</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/machine_channel.html"><code class="docutils literal notranslate"><span class="pre">tbot.machine.channel</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/error.html"><code class="docutils literal notranslate"><span class="pre">tbot.error</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/role.html"><code class="docutils literal notranslate"><span class="pre">tbot.role</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/selectable.html"><code class="docutils literal notranslate"><span class="pre">tbot.selectable</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testcase Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/tc.html"><code class="docutils literal notranslate"><span class="pre">tbot.tc</span></code> - Builtin Testcases</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/connector.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.connector</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/gdb.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.gdb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/gpio.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.gpio</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/linux.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.linux</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/locking.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.locking</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/swupdate.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.swupdate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/timing.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.timing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/uboot.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.uboot</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib/utils.html"><code class="docutils literal notranslate"><span class="pre">tbot_contrib.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing to tbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">tbot CLI</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cli.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <section id="tbot-cli">
<span id="cli"></span><h1>tbot CLI<a class="headerlink" href="#tbot-cli" title="Link to this heading">¶</a></h1>
<p>tbot is, for the most part, a library to interact with embedded devices and
automate working with them.  But it also ships with a CLI (commandline
interface) tool which ties together code using tbot.  Usage of this CLI is not
at all mandatory, you can write your own scripts just as well.  But the common
interface has proven to be quite useful for larger projects.</p>
<p>Advantages of using tbot’s CLI are:</p>
<ul class="simple">
<li><p>Automatic configuration</p></li>
<li><p>Easy mechanism to modularize configuration</p></li>
<li><p>Common command to call many different testcases</p></li>
<li><p>Provides commandline flags for common tbot debugging needs</p></li>
<li><p>Pretty output!</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The new CLI is called <code class="docutils literal notranslate"><span class="pre">newbot</span></code> and this is what will be described in this
document.  There is also an old tool called <code class="docutils literal notranslate"><span class="pre">tbot</span></code> which will be
deprecated in a future release.</p>
</div>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>A gentle introduction can be found in the <a class="reference internal" href="quickstart.html#quickstart"><span class="std std-ref">Quick Start</span></a> guide.  This
document here serves as a reference documentation.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>usage: tbot [options] [testcases ...]

positional arguments:
  testcase              testcases that should be run.

options:
  -h, --help            show this help message and exit
  -C WORKDIR            use WORKDIR as working directory instead of the current directory.
  -c CONFIG, --config CONFIG
  -f FLAG               set a user defined flag to change testcase behaviour
  -k, --keep-alive      keep machines alive for later tests to reacquire them
  -v                    increase the verbosity
  -q                    decrease the verbosity
  --version             show program&#39;s version number and exit
</pre></div>
</div>
<p>Testcases and configuration are specified as Python module paths.  For
testcases, the last element is the testcase function to be called.
Configuration modules are expected to contain a <code class="docutils literal notranslate"><span class="pre">register_machines()</span></code>
function which will be called to enable the config.  This can be expressed in
some simple equivalent Python code.  Calling</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>newbot<span class="w"> </span>-c<span class="w"> </span>config.my_config<span class="w"> </span>tc.examples.foo<span class="w"> </span>tc.interactive.linux
</pre></div>
</div>
<p>would, in simple terms, be equivalent to this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. load and enable config</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">config.my_config</span>
<span class="n">config</span><span class="o">.</span><span class="n">my_config</span><span class="o">.</span><span class="n">register_machines</span><span class="p">(</span><span class="n">tbot</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>

<span class="c1"># 2. run first testcase</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tc.examples</span>
<span class="n">tc</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>

<span class="c1"># 3. run second testcase</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tc.interactive</span>
<span class="n">tc</span><span class="o">.</span><span class="n">interactive</span><span class="o">.</span><span class="n">linux</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="f-flags">
<span id="cli-flags"></span><h2><code class="docutils literal notranslate"><span class="pre">-f</span></code> Flags<a class="headerlink" href="#f-flags" title="Link to this heading">¶</a></h2>
<p>Flags are a mechanism to allow quickly switching settings in configuration or
testcases.  For example, a flag might be used to switch to booting from a
different source.</p>
<p>All flags passed to <code class="docutils literal notranslate"><span class="pre">newbot</span></code> with <code class="docutils literal notranslate"><span class="pre">-f</span></code> are added to the
<code class="xref py py-data docutils literal notranslate"><span class="pre">tbot.flags</span></code> set.  Config and testcases can then check for them like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if flag is present</span>
<span class="k">if</span> <span class="s2">&quot;boot-nfs&quot;</span> <span class="ow">in</span> <span class="n">tbot</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
    <span class="n">bootargs</span> <span class="o">=</span> <span class="s2">&quot;root=/dev/nfs nfsroot=...,tcp,v3&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">bootargs</span> <span class="o">=</span> <span class="s2">&quot;root=/dev/mmcblk0p1&quot;</span>

<span class="c1"># Check if flag is absent</span>
<span class="k">if</span> <span class="s2">&quot;silent-boot&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tbot</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
    <span class="n">bootargs</span> <span class="o">+=</span> <span class="s2">&quot; loglevel=7&quot;</span>

<span class="n">uboot</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="s2">&quot;bootargs&quot;</span><span class="p">,</span> <span class="n">bootargs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="k-keep-alive">
<h2><code class="docutils literal notranslate"><span class="pre">-k</span></code> Keep Alive<a class="headerlink" href="#k-keep-alive" title="Link to this heading">¶</a></h2>
<p>By default, machine instances are “torn down” as soon as the outermost
with-block which requested them ends.  This means, that in the following code,
the board is rebooted between the two blocks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">tbot</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">BoardLinux</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
    <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;first boot&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">tbot</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">BoardLinux</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
    <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;second boot&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this is often not ideal because it leads to excessively long testcase
run times.  The <code class="docutils literal notranslate"><span class="pre">-k</span></code> flag instead changes behaviour such that an instance is
“kept alive” until the very end of a <code class="docutils literal notranslate"><span class="pre">newbot</span></code> run.  Thus, the board would not
reboot in the above example.</p>
<p>To make testcases which require a powercycle still work, they should explicitly
request a reset.  This way, it will work both with and without <code class="docutils literal notranslate"><span class="pre">-k</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">tbot</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">BoardLinux</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
    <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;first boot&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tbot</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">tbot</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">BoardLinux</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">lnx</span><span class="p">:</span>
    <span class="n">lnx</span><span class="o">.</span><span class="n">exec0</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="s2">&quot;second boot&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can read more about this in the <a class="reference internal" href="context.html#context"><span class="std std-ref">Context</span></a> documentation.</p>
</section>
<section id="v-verbose">
<h2><code class="docutils literal notranslate"><span class="pre">-v</span></code> Verbose<a class="headerlink" href="#v-verbose" title="Link to this heading">¶</a></h2>
<p>Verbose mode can be used to debug problems in lower layers of the
communication.  It shows all sent and received data on all “channels”.  For
example, when tbot doesn’t seem to recognize a login-prompt, this can help.</p>
</section>
<section id="migrating-to-newbot">
<h2>Migrating to <code class="docutils literal notranslate"><span class="pre">newbot</span></code><a class="headerlink" href="#migrating-to-newbot" title="Link to this heading">¶</a></h2>
<p>If you have previously written tbot code for the old <code class="docutils literal notranslate"><span class="pre">tbot</span></code> CLI tool, this
section details how to migrate to <code class="docutils literal notranslate"><span class="pre">newbot</span></code>.  Before starting here, please
adjust your code for the <a class="reference internal" href="context.html#context"><span class="std std-ref">Context</span></a> API as detailed in
<a class="reference internal" href="context.html#context-migration"><span class="std std-ref">Migrating to Context</span></a>.  <code class="docutils literal notranslate"><span class="pre">newbot</span></code> no longer supports the legacy style
configuration.</p>
<p>From there, everything should be quite straight forward.  The only thing which changes is the commandline syntax:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-l</span></code> and <code class="docutils literal notranslate"><span class="pre">-b</span></code> config arguments have been consolidated into a single
<code class="docutils literal notranslate"><span class="pre">-c</span></code> flag.  Instead of paths, you now need to specify Python modules.  So
<code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">configs/my_lab.py</span></code> becomes <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">configs.my_lab</span></code>.</p></li>
<li><p>Testcases are no longer “collected” from directories, they are now also
imported using standard Python imports.  A testcase called
<code class="docutils literal notranslate"><span class="pre">test_uboot_emmc</span></code> in a file <code class="docutils literal notranslate"><span class="pre">tc/uboot/tests.py</span></code> will now be called as
<code class="docutils literal notranslate"><span class="pre">tc.uboot.tests.test_uboot_emmc</span></code>.</p>
<p>As this can get quite cumbersome to type, it is often a good idea to
re-import testcases in a higher level module.  For example you could add this
line to <code class="docutils literal notranslate"><span class="pre">tc/__init__.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.uboot.tests</span><span class="w"> </span><span class="kn">import</span> <span class="n">test_uboot_emmc</span>
</pre></div>
</div>
<p>And then call the testcase as <code class="docutils literal notranslate"><span class="pre">tc.test_uboot_emmc</span></code>.</p>
</li>
</ul>
</section>
</section>


           </div>
          </div>
    <a href="https://github.com/Rahix/tbot">
        <img style="position: absolute; top: 0; right: 0; border: 0;" decoding="async" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" loading="lazy" data-recalc-dims="1">
    </a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Rahix.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>